
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Say Goodbye to Google Analytics Referral Spam</title>
    
    <meta name="author" content="Convertify">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!-- <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all"> -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <!-- <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
    <script type="text/javascript" src="/bower_components/simple-jekyll-search/dest/jekyll-search.js"></script>
  </head>

  <body>

    <div id="wrapper">
      <div class="overlay"></div>

      <!-- sidebar -->
      <nav class="navbar navbar-inverse navbar-fixed-top" id="sidebar-wrapper" role="navigation">
          <ul class="nav sidebar-nav">
              <li class="sidebar-brand">
                  <a href="#">
                     Categories
                  </a>
              </li>
              <li>
                  <a href="/case-studies/">Case Studies</a>
              </li>
              <li>
                  <a href="/analytics/">Analytics</a>
              </li>
              <li>
                  <a href="/e-commerce/">E-Commerce</a>
              </li>
              <li>
                  <a href="/guides/">Guides</a>
              </li>
              <li>
                  <a href="/scripts/">Scripts</a>
              </li>
              <li>
                  <a href="/tips/">Tips</a>
              </li>
              <!-- <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Works <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Dropdown heading</li>
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li> -->
              <!-- <li>
                  <a href="https://twitter.com/maridlcrmn">Follow me</a>
              </li> -->
          </ul>
      </nav>
      <!-- /#sidebar-wrapper -->

      <!-- Page Content -->
      <div id="page-content-wrapper">
        <button class="hamburger is-closed" type="button" data-toggle="offcanvas">
          <span class="hamb-top"></span>
          <span class="hamb-middle"></span>
          <span class="hamb-bottom"></span>
        </button>
        <div class="row">

          <div class="navbar navbar-inverse navbar-fixed-top yamm" id="navbar" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
        <img class="img-responsive brand nav-logo" src="/assets/images/blog.png" alt="">
      </a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
          <li><a href="http://convertify.io">Home</a></li>
          <li class=""><a href="http://convertify.io/no-guesswork">No Guesswork</a></li>
          <li class="dropdown yamm-fw">
            <a href="http://convertify.io/labs" class="dropdown-toggle" data-toggle="dropdown">Labs <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <div class="yamm-content yamm-fw">
                  <div class="row">
                    <div class="col-sm-4">
                      <ul class="list-unstyled">
                        <li>
                          <h4>Convertify Labs</h4>
                          <p>Free apps to help you increase your conversion rate.</p>
                          <br>
                        </li>
                        <li>
                          <p>
                            <strong>Plugins</strong>
                          </p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Pre-populator</a>
                          <p><small>Adds prepopulation to forms to increase conversions.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Scrollmark</a>
                          <p><small>Optimize your blog's usability and allow linking to certain sections to of your content.</small></p>
                        </li>
                      </ul>
                    </div>
                    <div class="col-sm-4">
                      <ul class="list-unstyled">
                        <li>
                          <p>
                            <strong>Convertify Apps</strong>
                          </p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Convertilyzer</a>
                          <p><small>Analyzes your website design and your analytics to give conversion optimization recommendations.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Boomerang</a>
                          <p><small>Reduce cart abandonment on your online store.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">SideStage</a>
                          <p><small>Call-to-actions optimized for today's banner-blindness which allows A/B testing of CTA's.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Personify</a>
                          <p><small>Personalize your site with URL parameters.</small></p>
                        </li>
                      </ul>
                    </div>
                    <div class="col-sm-4">
                      <ul class="list-unstyled">
                        <li>
                          <p>
                            <strong>Tools</strong>
                          </p>
                        </li>
                        <li>
                          <a href="http://convertify.io/labs/selector-tool">Selector Tool</a>
                          <p><small>Identify selectors on your site for use in tools &amp; goal-tracking.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Multistepper</a>
                          <p><small>Adds pre-population to your forms to increase conversions.</small></p>
                        </li>
                        <li>
                          <a href="http://convertify.io/quantify">Quantify</a>
                          <p><small>Quantify surveys quickly. Integrates with Qualaroo.</small></p>
                        </li>
                        <li class="coming-soon">
                          <a href="#">Event Buddy</a>
                          <p><small>Easily create GA events without any technical knowledge required.</small></p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </li>
          <li><a href="/categories.html#case-studies-ref">Case Studies</a></li>
          <li class="active"><a href="/">Blog</a></li>
          <li class=""><a href="mailto:c@convertify.io">Contact</a></li>
        </ul>
      </ul>
      <ul class="nav navbar-nav navbar-right">
          <li><a href="#search"><span class="glyphicon glyphicon-search"></span></a></li>
      </ul>
    </div>
  </div>
</div>

          <div class="container-fluid">

            <div class="content">
              

<div class='row shadow-above postBody'>
  <div class='col-sm-8 col-sm-offset-2'>
    
    <img alt='' class='featuredImage featuredImage--single img-responsive center-block' src='https://photos-6.dropbox.com/t/2/AACkQrk7DiNobkhuFKAOPrTaZVZuXFkObZvVvT35FzcRsQ/12/1406414/png/32x32/1/_/1/2/Screenshot%202015-06-07%2018.27.19.png/CM7rVSABIAIgAyAEIAUgBiAHKAEoAg/faeQEL9T2cdtqrd8WM3LnNfjfwYtBESV4axDrcJ0Svg?size=1280x960&size_mode=2'>
    
    
    <h1 class='postTitle'>Say Goodbye to Google Analytics Referral Spam</h1>
    
    <p>Lately, referral spam has become a big issue, significantly skewing results in everyone’s analytics reports. The “exclusion filters” feature of Google Analytics has been a help, but it’s tedious to keep adding more filters whenever new spammers pop up, and a lot of the times the filters just don’t cut it.</p>

<p><strong>Lucky for you, we’ve put together something that will make referral a spam a problem of the past.</strong></p>

<p>Because referral spam has become such a problem, a small community of people have decided to put together a <a href="https://github.com/piwik/referrer-spam-blacklist">Referrer spam blacklist</a> which is updated whenever someone finds a new spammer in their reports. The list is well-maintained and updated <a href="https://github.com/piwik/referrer-spam-blacklist/graphs/contributors">quite often</a>. Now, what if there was a way for you to somehow integrate this list into your website, such that whenever a referral is detected from any domain in that blacklist, they automatically get exluded from your tracking? Well, we built exactly that, and it’ll only take a few minutes for you to set it up!</p>

<p>We’ve put together a special version of the google analytics tracking code which will only run if the referrer is not included in the blacklist. This way, you don’t have to set up any filters to get rid of spammers, and it automatically updates itself whenever new spammers are found. Here’s how it works:</p>

<ol>
  <li>First, it requests a copy of the blacklist before allowing any tracking to happen. Because Github doesn’t <a href="http://stackoverflow.com/questions/14033281/including-javascript-files-from-github-into-html-pages">allow you to include files</a> directly from their website, we’ve hosted a copy of it on an Amazon S3 server and setup a task that updates the blacklist daily.</li>
  <li>Next, it checks the referrer against the blacklist, and tracks the visitor <strong><em>if and only if</em></strong> the referrer does not match any of the referrers in the blacklist.</li>
</ol>

<p>Now let’s move on to getting this setup on your website.</p>

<h2 id="instructions">Instructions</h2>

<p>Setting this up is pretty easy. All you need to do is replace your current Google Analytics tracking script with this one:</p>

<script src="https://gist.github.com/coopermaruyama/b5a16e51433db2ab8514.js"> </script>

<p>Once you’ve done that, that’s it! No more referral spam.</p>

<p>Note that if you have a customized tracking script because you’re using enhanced link attribution or some other feature, you can freely replace the current script in the example. You can also add any other tracking scripts you have, as long as they are inserted below the <code>Place any tracking scripts here</code> comment and above the <code>End tracking scripts</code> comment.</p>

<p>I hope this is the last time you have to deal with referral spam. If you have any questions or need help setting this up, leave a comment below. Enjoy!</p>

<hr />

<p>In case you’re curious about the exact source for this script, here’s the un-minified code below:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="cm">/*</span>
<span class="cm"> * Detect if the referrer is a referral spammer and prevent google analytics</span>
<span class="cm"> * loading if that is the case.</span>
<span class="cm"> *</span>
<span class="cm"> * @author Cooper Maruyama</span>
<span class="cm"> * @website convertify.io</span>
<span class="cm"> */</span>

<span class="c1">// Runs if referrer is valid.</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">trackVisitor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Your analytics script goes here.</span>
<span class="p">}</span>

<span class="cm">/*======================================================</span>
<span class="cm">=    Don&#39;t edit anything below!</span>
<span class="cm">======================================================*/</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">trackVisitor</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">BLACKLIST_URL</span><span class="o">=</span><span class="s2">&quot;https://s3.amazonaws.com/s3.convertify.io/spammers.txt&quot;</span><span class="p">;</span>

  <span class="c1">// Fetch blacklist and perform validation.</span>
  <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">BLACKLIST_URL</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Parse the list</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
        <span class="nx">validateReferrer</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">trackVisitor</span><span class="p">();</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Spam detected! bypass tracking.</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// AJAX request failed. Track anyways.</span>
        <span class="nx">trackVisitor</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
  <span class="nx">request</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   *  Validates referrer against a blacklist of known spammers.</span>
<span class="cm">   *</span>
<span class="cm">   *  @param   {String}   blacklist - Blacklist of known spammers, delimited by</span>
<span class="cm">   *                                  new line.</span>
<span class="cm">   *</span>
<span class="cm">   *  @param   {Function} callback  - Callback to call. Passes an error as the</span>
<span class="cm">   *                                  as the 1st argument or null if no error.</span>
<span class="cm">   *                                  Passes true as the 2nd argument if the</span>
<span class="cm">   *                                  visitor is valid, or false if the visitor</span>
<span class="cm">   *                                  is a spammer and should not be tracked.</span>
<span class="cm">   *</span>
<span class="cm">   *</span>
<span class="cm">   *  @return  {Null}</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">validateReferrer</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">blacklist</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">badReferrers</span> <span class="o">=</span> <span class="nx">blacklist</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">isReferrerBad</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">listLength</span> <span class="o">=</span> <span class="nx">badReferrers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">listLength</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">badReferrers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">referrer</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">isReferrerBad</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isReferrerBad</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Referral spam detected!</span>
      <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">trackVisitor</span><span class="p">);</span></code></pre></div>


    <!-- Prev/Next Articles  -->
    <hr>
    <h3 class="text-center">Recommended For You</h3>
<br>
<div class="row">
  <style type="text/css" media="screen">
    /* Custom styles for panels */
    .panel-thumbnail.mod-bg {
      background-size: cover;
      background-position: center center;
      max-height: 250px;
    }
    .panel-thumbnail.mod-bg img {
      opacity: 0;
      z-index: -1;
    }
  </style>
  
    <div class="col-sm-6">
      <div class="panel panel-default">
        <a href="/tips/why-your-winning-ab-tests-arent-improving-your-bottomline"><div class="panel-thumbnail mod-bg" style="background-image: url(https://s3.amazonaws.com/convertify-s3/blog/images/2015/03/angry-man-computer.jpg);"><img class="img-responsive featuredImage"
          src="https://s3.amazonaws.com/convertify-s3/blog/images/2015/03/angry-man-computer.jpg"></div></a>
        <div class="panel-body">
          <p class="lead title"><a
            href="/tips/why-your-winning-ab-tests-arent-improving-your-bottomline">Why Your Winning A/B Tests Aren't Improving Your Bottom-line</a></p>
          <p class="meta">Posted 03 March 2015</p>
          <p class="tags">
            <!-- <img src="https://lh4.googleusercontent.com/-9Yw2jNffJlE/AAAAAAAAAAI/AAAAAAAAAAA/u3WcFXvK-g8/s28-c-k-no/photo.jpg" width="28px" height="28px"> -->
            
             <span class="label label-info">tips</span>
            
             <span class="label label-info">testing platforms</span>
            
          </p>
        </div>
      </div><!--/panel-->
    </div><!--/col-->
  
  <!--/col-->
  
    <div class="col-sm-6">
      <div class="panel panel-default">
        <a href="/tips/analytics/goals-are-simply-outcomes-we-want"><div class="panel-thumbnail mod-bg" style="background-image: url(http://s3.convertify.io/images/goals.jpg);"><img class="img-responsive featuredImage"
          src="http://s3.convertify.io/images/goals.jpg"></div></a>
        <div class="panel-body">
          <p class="lead title"><a
            href="/tips/analytics/goals-are-simply-outcomes-we-want">Goals Are Nothing But Outcomes We Want</a></p>
          <p class="meta">Posted 07 June 2015</p>
          <p class="tags">
            <!-- <img src="https://lh4.googleusercontent.com/-eSs1F2O7N1A/AAAAAAAAAAI/AAAAAAAAAAA/caHwQFv2RqI/s28-c-k-no/photo.jpg" width="28px" height="28px"> -->
            <!-- <img src="https://lh4.googleusercontent.com/-9Yw2jNffJlE/AAAAAAAAAAI/AAAAAAAAAAA/u3WcFXvK-g8/s28-c-k-no/photo.jpg" width="28px" height="28px"> -->
            
             <span class="label label-info">tips</span>
            
             <span class="label label-info">analytics</span>
            
          </p>
        </div>
      </div><!--/panel-->
    </div><!--/col-->
  
</div>




    <ul class="pager">
    
      <li class='previous'>
        <a href='/tips/why-your-winning-ab-tests-arent-improving-your-bottomline' title='Why Your Winning A/B Tests Aren't Improving Your Bottom-line'>← Previous</a>
      </li>
    
     <!--  <li>
        <a href='/archive.html'>Archive</a>
      </li> -->
    
      <li class='next'>
        <a href='/tips/analytics/goals-are-simply-outcomes-we-want' title='Goals Are Nothing But Outcomes We Want'>Next →</a>
      </li>
    
      </li>
    </ul>
    <hr>
  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'convertify'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54292ae863f68dce" async="async"></script>

  </div>
</div>



            </div>

            <footer>
              <p class="pull-left">
                &copy; Convertify 2012
              </p>
              <p class="pull-right">
                <a href="https://mixpanel.com/f/partner"><img src="//cdn.mxpnl.com/site_media/images/partner/badge_light.png" alt="Mobile Analytics" /></a>
              </p>
            </footer>
            <div id="search">
    <button type="button" class="close">×</button>
    <form class="form--search">
        <input id="search-input" type="search" value="" placeholder="type keyword(s) here" />
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <div class="list-searches">
    	<div class="col-xs-12">
    		<ul id="list--searchResults" class="thumbnails"></ul>
    	</div>
    </div>
</div>
<script type="text/javascript">
	/*
	 * jQuery throttle / debounce - v1.1 - 3/7/2010
	 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
	 * 
	 * Copyright (c) 2010 "Cowboy" Ben Alman
	 * Dual licensed under the MIT and GPL licenses.
	 * http://benalman.com/about/license/
	 */
	(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
	// end jquery.debounce
	function updateQueryStringParameter(uri, key, value) {
	  var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
	  var separator = uri.indexOf('?') !== -1 ? "&" : "?";
	  if (uri.match(re)) {
	    return uri.replace(re, '$1' + key + "=" + value + '$2');
	  }
	  else {
	    return uri + separator + key + "=" + value;
	  }
	}
	// end plugins


	$(function () {
	    $('a[href="#search"]').on('click', function(event) {
	        event.preventDefault();
	        $('#search').addClass('open');
	        $('#search > form > input[type="search"]').focus();
	        $("body").addClass("is--searching");
	    });
	    
	    $('#search, #search button.close').on('click keyup', function(event) {
	        if (event.target == this || event.target.className == 'close' || event.keyCode == 27) {
	            $(this).removeClass('open');
	            $("body").removeClass("is--searching");
	        }
	    });
	    $("#search-input").on('keyup', $.debounce( 500, false, function(e)  {
	    	console.log("tracking search "+$(this).val());
	    	var newURL = updateQueryStringParameter(window.location.href, "q", $(this).val());
	    	ga('send', 'pageview', newURL);
	    }));
	    
	    $('form.form--search').submit(function(event) {
	        event.preventDefault();
	        return false;
	    });
	    // Init search datasource
	    SimpleJekyllSearch.init({
	      searchInput: document.getElementById('search-input'),
	      resultsContainer: document.getElementById('list--searchResults'),
	      dataSource: '/search.json',
	      searchResultTemplate: '<div class="col-sm-4 searchResult"><div class="thumbnail"><a href="{url}"><img class="img-responsive" src="{image}"></a><div class="caption"><h4><a href="{url}">{title}</a></h4><p>{excerpt}</p></div></div></div>'
	    })
	});
</script>

          </div> <!-- /container -->
        </div>
      </div>
    </div>

    <!--  -->

    <script type="text/javascript">
      $(document).ready(function () {
        var trigger = $('.hamburger'),
            overlay = $('.overlay'),
           isClosed = false;

          trigger.click(function () {
            hamburger_cross();
          });

          function hamburger_cross() {

            if (isClosed == true) {
              overlay.hide();
              trigger.removeClass('is-open');
              trigger.addClass('is-closed');
              isClosed = false;
            } else {
              overlay.show();
              trigger.removeClass('is-closed');
              trigger.addClass('is-open');
              isClosed = true;
            }
        }

        $('[data-toggle="offcanvas"]').click(function () {
              $('#wrapper').toggleClass('toggled');
        });
      });
    </script>
    <script>

      /*!
       *  Referral spam blocker
       *
       *  @author Cooper Maruyama
       *  @site https://convertify.io
       */
      window.trackVisitor = function() {
        /* Put any tracking scripts here */
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-50332705-3', 'auto');
        ga('send', 'pageview');

        /* End Tracking Scripts */
      }
      /* DONT EDIT ANYTHING BELOW THIS LINE!! */
      ;(function(a,b){var c="https://s3.amazonaws.com/s3.convertify.io/spammers.txt",d=new XMLHttpRequest;d.open("GET",c,!0),d.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<400){var a=this.responseText;e(a,function(a,c){c&&b()})}else b()},d.send(),d=null;var e=function(b,c){var d=b.split("\n"),e=!1,f=d.length-1;for(i=0;i<f;i++){var g=new RegExp(d[i]);if(g.test(a.referrer)){e=!0;break}}e?c(null,!1):c(null,!0)}})(document,window.trackVisitor);
    </script>
  </body>
</html>

